<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="club">

	<select id="selectClubList" parameterType="hashmap" resultType="hashmap">
		<include refid="com.pagingPre"/>
			SELECT
				c.clubNo,
				c.clubNm,
				c.mstrMmbrNo,
				m.nickNm AS mstrNickNm,
				IFNULL(m.prflImgFileNm, '') AS mstrPrflImgFileNm,
				c.clubTypeCd,
				cdNm('C004', c.clubTypeCd) AS clubTypeNm,
				c.clubGrdCd,
				cdNm('C005', c.clubGrdCd) AS clubGrdNm,
				IFNULL(c.telNo, '') AS telNo,
				CONCAT(IFNULL(c.addrs1, ''), ' ', IFNULL(c.addrs2, '')) AS addrs,
				IFNULL(c.lat, '') AS lat,
				IFNULL(c.lng, '') AS lng,
				IFNULL(c.prflImgFileNm, '') AS prflImgFileNm,
				(SELECT
					IF(COUNT(*) > 0, 'Y', 'N')
				FROM
					clubMmbr cm1
				WHERE
					c.clubNo = cm1.clubNo
				AND
					cm1.activated IS TRUE
				AND
					cm1.mmbrNo = #{mmbrNo}
				) AS myClubYn,
				(SELECT
					COUNT(*)
				FROM
					clubGame cg1
				WHERE
					c.clubNo = cg1.clubNo
				) AS clubGameHasYCnt,
				(SELECT
					COUNT(*)
				FROM
					clubMmbr cm2
				WHERE
					c.clubNo = cm2.clubNo
				AND
					cm2.activated IS TRUE
				) AS clubMmbrCnt,
				IFNULL((SELECT
					MAX(DATE(p1.endDt))
				FROM
					play p1
				WHERE
					c.clubNo = p1.clubNo
				), '') AS clubPlayDateMax
			FROM
				club c,
				mmbr m
			WHERE
				c.mstrMmbrNo = m.mmbrNo
			AND
				c.useYn = 'Y'
			<if test="srchText != null and srchText != ''">
			AND
				(c.clubNm LIKE CONCAT('%',#{srchText},'%')
				OR
				c.addrs1 LIKE CONCAT('%',#{srchText},'%')
				OR
				m.nickNm LIKE CONCAT('%',#{srchText},'%'))
			</if>
			ORDER BY
				c.clubNo
		<include refid="com.pagingPost"/>
	</select>
	
	<select id="selectClubListCnt" parameterType="hashmap" resultType="hashmap">
			SELECT
				COUNT(*) AS cnt
			FROM
				club c,
				mmbr m
			WHERE
				c.mstrMmbrNo = m.mmbrNo
			AND
				c.useYn = 'Y'
			<if test="srchText != null and srchText != ''">
			AND
				(c.clubNm LIKE CONCAT('%',#{srchText},'%')
				OR
				c.addrs1 LIKE CONCAT('%',#{srchText},'%')
				OR
				m.nickNm LIKE CONCAT('%',#{srchText},'%'))
			</if>
	</select>
	
	<select id="selectClubBrdList" parameterType="hashmap" resultType="hashmap">
		<include refid="com.pagingPre"/>
			SELECT
				cb.seq,
				cb.mmbrNo,
				m.nickNm,
				IFNULL(m.prflImgFileNm, '') AS prflImgFileNm,
				cb.brdTypeCd,
				cdNm('C007', cb.brdTypeCd) AS brdTypeNm,
				cb.title,
				cb.cntnts,
				DATE_FORMAT(cb.insDt, "%Y.%m.%d %H:%i") AS insDt
			FROM
				clubBrd cb,
				mmbr m
			WHERE
				cb.mmbrNo = m.mmbrNo
			AND
				cb.useYn = 'Y'
			AND
				m.useYn = 'Y'
			ORDER BY
				cb.seq
		<include refid="com.pagingPost"/>
	</select>
	
	<select id="selectClubBrdListCnt" parameterType="hashmap" resultType="hashmap">
		<![CDATA[
			SELECT
				COUNT(*) AS cnt
			FROM
				clubBrd cb,
				mmbr m
			WHERE
				cb.mmbrNo = m.mmbrNo
			AND
				cb.useYn = 'Y'
			AND
				m.useYn = 'Y'
		]]>
	</select>
	
	<select id="selectClubBrd" parameterType="hashmap" resultType="hashmap">
		<![CDATA[
			SELECT
				cb.seq,
				cb.mmbrNo,
				m.nickNm,
				IFNULL(m.prflImgFileNm, '') AS prflImgFileNm,
				cb.brdTypeCd,
				cdNm('C007', cb.brdTypeCd) AS brdTypeNm,
				cb.title,
				cb.cntnts,
				DATE_FORMAT(cb.insDt, "%Y.%m.%d %H:%i") AS insDt
			FROM
				clubBrd cb,
				mmbr m
			WHERE
				cb.mmbrNo = m.mmbrNo
			AND
				cb.seq = #{seq}
		]]>
	</select>
	
	<insert id="insertClubBrd" parameterType="hashmap">
			INSERT INTO clubBrd
			(
				clubNo,
				mmbrNo,
				brdTypeCd,
				title,
				cntnts,
				useYn,
				insId,
				insDt,
				updId,
				updDt
			)
			VALUES
			(
				#{clubNo},
				#{mmbrNo},
				#{brdTypeCd},
				TRIM(#{title}),
				TRIM(#{cntnts}),
				'Y',
				'system',
				CURRENT_TIMESTAMP,
				'system',
				CURRENT_TIMESTAMP
			)
	</insert>
	
	<update id="updateClubBrd" parameterType="hashmap">
			UPDATE
				clubBrd
			SET
			<if test="brdTypeCd != null and brdTypeCd != ''">
				brdTypeCd = #{brdTypeCd},
			</if>
			<if test="title != null and title != ''">
				title = TRIM(#{title}),
			</if>
			<if test="cntnts != null and cntnts != ''">
				cntnts = TRIM(#{cntnts}),
			</if>
			<if test="useYn != null and useYn != ''">
				useYn = #{useYn},
			</if>
				updId = 'system',
				updDt = CURRENT_TIMESTAMP
			WHERE
				seq = #{seq}
	</update>
	
	<delete id="deleteClubBrd" parameterType="hashmap">
		<![CDATA[
			DELETE FROM
				clubBrd
			WHERE
				seq = #{seq}
		]]>
	</delete>
	
	
	<insert id="insertClub" parameterType="hashmap">
			INSERT INTO club
			(
				clubNo,
				clubNm,
				mstrMmbrNo,
				clubTypeCd,
				clubGrdCd,
			<if test="telNo != null and telNo != ''">
				telNo,
			</if>
			<if test="addrs1 != null and addrs1 != ''">
				addrs1,
			</if>
			<if test="addrs2 != null and addrs2 != ''">
				addrs2,
			</if>
			<if test="zipCd != null and zipCd != ''">
				zipCd,
			</if>
			<if test="lat != null and lat != ''">
				lat,
			</if>
			<if test="lng != null and lng != ''">
				lng,
			</if>
			<if test="feeAccntBankCd != null and feeAccntBankCd != ''">
				feeAccntBankCd,
			</if>
			<if test="feeAccntNo != null and feeAccntNo != ''">
				feeAccntNo,
			</if>
			<if test="feeAccntNm != null and feeAccntNm != ''">
				feeAccntNm,
			</if>
			<if test="feeType1Amt != null and feeType1Amt != ''">
				feeType1Amt,
			</if>
			<if test="feeType2Amt != null and feeType2Amt != ''">
				feeType2Amt,
			</if>
			<if test="prflImgFileNm != null and prflImgFileNm != ''">
				prflImgFileNm,
			</if>
			<if test="intrdctn != null and intrdctn != ''">
				intrdctn,
			</if>
			<if test="joinQstn != null and joinQstn != ''">
				joinQstn,
			</if>
				useYn,
				insId,
				insDt,
				updId,
				updDt
			)
			VALUES
			(
				#{clubNo},
				#{clubNm},
				#{mmbrNo},
				#{clubTypeCd},
				#{clubGrdCd},
			<if test="telNo != null and telNo != ''">
				#{telNo},
			</if>
			<if test="addrs1 != null and addrs1 != ''">
				#{addrs1},
			</if>
			<if test="addrs2 != null and addrs2 != ''">
				#{addrs2},
			</if>
			<if test="zipCd != null and zipCd != ''">
				#{zipCd},
			</if>
			<if test="lat != null and lat != ''">
				#{lat},
			</if>
			<if test="lng != null and lng != ''">
				#{lng},
			</if>
			<if test="feeAccntBankCd != null and feeAccntBankCd != ''">
				#{feeAccntBankCd},
			</if>
			<if test="feeAccntNo != null and feeAccntNo != ''">
				#{feeAccntNo},
			</if>
			<if test="feeAccntNm != null and feeAccntNm != ''">
				#{feeAccntNm},
			</if>
			<if test="feeType1Amt != null and feeType1Amt != ''">
				REPLACE(#{feeType1Amt}, ',', ''),
			</if>
			<if test="feeType2Amt != null and feeType2Amt != ''">
				REPLACE(#{feeType2Amt}, ',', ''),
			</if>
			<if test="prflImgFileNm != null and prflImgFileNm != ''">
				#{prflImgFileNm},
			</if>
			<if test="intrdctn != null and intrdctn != ''">
				TRIM(#{intrdctn}),
			</if>
			<if test="joinQstn != null and joinQstn != ''">
				TRIM(#{joinQstn}),
			</if>
				'Y',
				'system',
				CURRENT_TIMESTAMP,
				'system',
				CURRENT_TIMESTAMP
			)
	</insert>
	
	<update id="updateClub" parameterType="hashmap">
			UPDATE
				club
			SET
			<if test="clubNm != null and clubNm != ''">
				clubNm = #{clubNm},
			</if>
			<if test="mstrMmbrNo != null and mstrMmbrNo != ''">
				mstrMmbrNo = #{mstrMmbrNo},
			</if>
			<if test="clubTypeCd != null and clubTypeCd != ''">
				clubTypeCd = #{clubTypeCd},
			</if>
			<if test="clubGrdCd != null and clubGrdCd != ''">
				clubGrdCd = #{clubGrdCd},
			</if>
			<if test="prmmFromDate != null and prmmFromDate != ''">
				prmmFromDate = #{prmmFromDate},
			</if>
			<if test="prmmToDate != null and prmmToDate != ''">
				prmmToDate = #{prmmToDate},
			</if>
			<if test="telNo != null and telNo != ''">
				telNo = #{telNo},
			</if>
			<if test="addrs1 != null and addrs1 != ''">
				addrs1 = #{addrs1},
			</if>
			<if test="addrs2 != null and addrs2 != ''">
				addrs2 = #{addrs2},
			</if>
			<if test="zipCd != null and zipCd != ''">
				zipCd = #{zipCd},
			</if>
			<if test="lat != null and lat != ''">
				lat = #{lat},
			</if>
			<if test="lng != null and lng != ''">
				lng = #{lng},
			</if>
			<if test="feeAccntBankCd != null and feeAccntBankCd != ''">
				feeAccntBankCd = #{feeAccntBankCd},
			</if>
			<if test="feeAccntNo != null and feeAccntNo != ''">
				feeAccntNo = #{feeAccntNo},
			</if>
			<if test="feeAccntNm != null and feeAccntNm != ''">
				feeAccntNm = #{feeAccntNm},
			</if>
			<if test="feeType1Amt != null and feeType1Amt != ''">
				feeType1Amt = REPLACE(#{feeType1Amt}, ',', ''),
			</if>
			<if test="feeType2Amt != null and feeType2Amt != ''">
				feeType2Amt = REPLACE(#{feeType2Amt}, ',', ''),
			</if>
			<if test="prflImgFileNm != null and prflImgFileNm != ''">
				prflImgFileNm = #{prflImgFileNm},
			</if>
			<if test="intrdctn != null and intrdctn != ''">
				intrdctn = TRIM(#{intrdctn}),
			</if>
			<if test="joinQstn != null and joinQstn != ''">
				joinQstn = TRIM(#{joinQstn}),
			</if>
			<if test="useYn != null and useYn != ''">
				useYn = #{useYn},
			</if>
				updId = 'system',
				updDt = CURRENT_TIMESTAMP
			WHERE
				clubNo = #{clubNo}
	</update>
	
	<delete id="deleteClub" parameterType="hashmap">
		<![CDATA[
			DELETE FROM
				club
			WHERE
				clubNo = #{clubNo}
		]]>
	</delete>
	
	
	<insert id="insertClubMmbr" parameterType="hashmap">
			INSERT INTO clubMmbr
			(
				clubNo,
				mmbrNo,
				clubMmbrGrdCd,
				fromDate,
				activated,
				insId,
				insDt,
				updId,
				updDt
			)
			VALUES
			(
				#{clubNo},
				#{mmbrNo},
				#{clubMmbrGrdCd},
				CURDATE(),
				FALSE,
				'system',
				CURRENT_TIMESTAMP,
				'system',
				CURRENT_TIMESTAMP
			)
	</insert>
	
	<update id="updateClubMmbr" parameterType="hashmap">
			UPDATE
				clubMmbr
			SET
			<if test="clubMmbrGrdCd != null and clubMmbrGrdCd != ''">
				clubMmbrGrdCd = #{clubMmbrGrdCd},
			</if>
			<if test="fromDate != null and fromDate != ''">
				fromDate = #{fromDate},
			</if>
			<if test="activated != null and activated != ''">
				activated = #{activated},
			</if>
				updId = 'system',
				updDt = CURRENT_TIMESTAMP
			WHERE
				clubNo = #{clubNo}
			AND
				mmbrNo = #{mmbrNo}
	</update>
	
	<delete id="deleteClubMmbr" parameterType="hashmap">
		<![CDATA[
			DELETE FROM
				clubMmbr
			WHERE
				clubNo = #{clubNo}
			AND
				mmbrNo = #{mmbrNo}
		]]>
	</delete>
	
	
	<insert id="insertClubJoin" parameterType="hashmap">
			INSERT INTO clubJoin
			(
				clubNo,
				mmbrNo,
				joinAnswr,
				reqDate,
				insId,
				insDt,
				updId,
				updDt
			)
			VALUES
			(
				#{clubNo},
				#{mmbrNo},
				TRIM(#{joinAnswr}),
				CURDATE(),
				'system',
				CURRENT_TIMESTAMP,
				'system',
				CURRENT_TIMESTAMP
			)
	</insert>
	
	<update id="updateClubJoin" parameterType="hashmap">
			UPDATE
				clubJoin
			SET
			<if test="mode == 'cnfrm'.toString()">
				cnfrmYn = 'Y',
				cnfrmDate = CURDATE(),
			</if>
			<if test="mode == 'rjct'.toString()">
				cnfrmYn = 'N',
				cnfrmDate = CURDATE(),
			</if>
				updId = 'system',
				updDt = CURRENT_TIMESTAMP
			WHERE
				seq = #{seq}
	</update>
	
	<delete id="deleteClubJoin" parameterType="hashmap">
		<![CDATA[
			DELETE FROM
				clubJoin
			WHERE
				clubNo = #{clubNo}
			AND
				mmbrNo = #{mmbrNo}
		]]>
	</delete>
	
	
	<select id="selectClubPrfl" parameterType="hashmap" resultType="hashmap">
		<![CDATA[
			SELECT
				c.clubNo,
				c.clubNm,
				c.mstrMmbrNo,
				m.nickNm AS mstrMmbrNm,
				c.clubTypeCd,
				cdNm('C004', c.clubTypeCd) AS clubTypeNm,
				c.clubGrdCd,
				cdNm('C005', c.clubGrdCd) AS clubGrdNm,
				IFNULL(c.telNo, '') AS telNo,
				CONCAT(IFNULL(c.addrs1, ''), ' ', IFNULL(c.addrs2, '')) AS addrs,
				IFNULL(c.prflImgFileNm, '') AS prflImgFileNm,
				IFNULL(c.intrdctn, '') AS intrdctn,
				IFNULL(c.joinQstn, '') AS joinQstn,
				(SELECT
					IF(COUNT(*) > 0, 'Y', 'N')
				FROM
					clubMmbr cm1
				WHERE
					cm1.mmbrNo = #{mmbrNo}
				AND
					cm1.activated IS TRUE
				) AS clubJoinYn,
				(SELECT
					IF(COUNT(*) > 0, 'Y', 'N')
				FROM
					clubMmbr cm1
				WHERE
					c.clubNo = cm1.clubNo
				AND
					cm1.activated IS TRUE
				AND
					cm1.mmbrNo = #{mmbrNo}
				) AS quitClubYn,
				(SELECT
					IF(COUNT(*) > 0, 'Y', 'N')
				FROM
					clubJoin cj1
				WHERE
					cj1.cnfrmYn IS NULL
				AND
					cj1.mmbrNo = #{mmbrNo}
				) AS mmbrClubJoinIngYn,
				(SELECT
					IF(COUNT(*) > 0, 'Y', 'N')
				FROM
					clubJoin cj2
				WHERE
					c.clubNo = cj2.clubNo
				AND
					cj2.cnfrmYn IS NULL
				AND
					cj2.mmbrNo = #{mmbrNo}
				) AS joinClubIngYn,
				IF(c.mstrMmbrNo = #{mmbrNo},
					'Y',
					'N'
				) AS mstrMmbrYn
			FROM
				club c,
				mmbr m
			WHERE
				c.mstrMmbrNo = m.mmbrNo
			AND
				c.clubNo = #{clubNo}
		]]>
	</select>
	
	<select id="selectClubMmbrList" parameterType="hashmap" resultType="hashmap">
		<include refid="com.pagingPre"/>
			SELECT
				cm.mmbrNo,
				m.nickNm,
				cm.clubMmbrGrdCd,
				cdNm('C003', cm.clubMmbrGrdCd) AS clubMmbrGrdNm,
				cm.fromDate,
				IFNULL(m.prflImgFileNm, 'default') AS prflImgFileNm,
				(SELECT
					COUNT(*)
				FROM
					playMmbr pm1
				WHERE
					pm1.mmbrNo = m.mmbrNo
				) AS playCnt
			FROM
				club c,
				clubMmbr cm,
				mmbr m
			WHERE
				c.clubNo = cm.clubNo
			AND
				cm.mmbrNo = m.mmbrNo
			AND
				c.useYn = 'Y'
			AND
				m.useYn = 'Y'
			AND
				cm.activated IS TRUE
			AND
				c.clubNo = #{clubNo}
			ORDER BY
				cm.fromDate
		<include refid="com.pagingPost"/>
	</select>
	
	<select id="selectClubMmbrListCnt" parameterType="hashmap" resultType="hashmap">
		<![CDATA[
			SELECT
				COUNT(*) AS cnt
			FROM
				club c,
				clubMmbr cm,
				mmbr m
			WHERE
				c.clubNo = cm.clubNo
			AND
				cm.mmbrNo = m.mmbrNo
			AND
				c.useYn = 'Y'
			AND
				m.useYn = 'Y'
			AND
				cm.activated IS TRUE
			AND
				c.clubNo = #{clubNo}
		]]>
	</select>
	
	
	<select id="selectClubGameList" parameterType="hashmap" resultType="hashmap">
		<include refid="com.pagingPre"/>
			SELECT
				cg.gameNo,
				g.gameNm,
				g.minPlyrCnt,
				g.maxPlyrCnt,
				(SELECT
					COUNT(*)
				FROM
					play p1
				WHERE
					p1.clubNo = cg.clubNo
				AND
					p1.gameNo = cg.gameNo
				) AS playCnt
			FROM
				club c,
				clubGame cg,
				game g
			WHERE
				c.clubNo = cg.clubNo
			AND
				cg.gameNo = g.gameNo
			AND
				c.useYn = 'Y'
			AND
				c.clubNo = #{clubNo}
			ORDER BY
				cg.gameNo
		<include refid="com.pagingPost"/>
	</select>
	
	<select id="selectClubGameListCnt" parameterType="hashmap" resultType="hashmap">
		<![CDATA[
			SELECT
				COUNT(*) AS cnt
			FROM
				club c,
				clubGame cg,
				game g
			WHERE
				c.clubNo = cg.clubNo
			AND
				cg.gameNo = g.gameNo
			AND
				c.useYn = 'Y'
			AND
				c.clubNo = #{clubNo}
		]]>
	</select>
	
	
	<select id="selectClubMapList" parameterType="hashmap" resultType="hashmap">
			SELECT
				c.clubNo,
				c.clubNm,
				c.mstrMmbrNo,
				m.nickNm AS mstrNickNm,
				IFNULL(m.prflImgFileNm, '') AS mstrPrflImgFileNm,
				c.clubTypeCd,
				cdNm('C004', c.clubTypeCd) AS clubTypeNm,
				c.clubGrdCd,
				cdNm('C005', c.clubGrdCd) AS clubGrdNm,
				IFNULL(c.telNo, '') AS telNo,
				CONCAT(IFNULL(c.addrs1, ''), ' ', IFNULL(c.addrs2, '')) AS addrs,
				IFNULL(c.lat, '') AS lat,
				IFNULL(c.lng, '') AS lng,
				IFNULL(c.prflImgFileNm, '') AS prflImgFileNm,
				(SELECT
					COUNT(*)
				FROM
					clubGame cg1
				WHERE
					c.clubNo = cg1.clubNo
				) AS clubGameHasYCnt,
				(SELECT
					COUNT(*)
				FROM
					clubMmbr cm2
				WHERE
					c.clubNo = cm2.clubNo
				AND
					cm2.activated IS TRUE
				) AS clubMmbrCnt,
				IFNULL((SELECT
					MAX(DATE(p1.endDt))
				FROM
					play p1
				WHERE
					c.clubNo = p1.clubNo
				), '') AS clubPlayDateMax
			FROM
				club c,
				mmbr m
			WHERE
				c.mstrMmbrNo = m.mmbrNo
			AND
				c.useYn = 'Y'
			<if test="srchText != null and srchText != ''">
			AND
				(c.clubNm LIKE CONCAT('%',#{srchText},'%')
				OR
				c.addrs1 LIKE CONCAT('%',#{srchText},'%')
				OR
				m.nickNm LIKE CONCAT('%',#{srchText},'%'))
			</if>
			ORDER BY
				c.clubNo
	</select>
	
	
	<select id="selectMyClub" parameterType="hashmap" resultType="hashmap">
		<![CDATA[
			SELECT
				c.clubNo,
				c.clubNm,
				c.mstrMmbrNo,
				m.nickNm AS mstrMmbrNm,
				c.clubTypeCd,
				cdNm('C004', c.clubTypeCd) AS clubTypeNm,
				c.clubGrdCd,
				cdNm('C005', c.clubGrdCd) AS clubGrdNm,
				IFNULL(c.prmmFromDate, '') AS prmmFromDate,
				IFNULL(c.prmmToDate, '') AS prmmToDate,
				IFNULL(c.telNo, '') AS telNo,
				IFNULL(c.addrs1, '') AS addrs1,
				IFNULL(c.addrs2, '') AS addrs2,
				IFNULL(c.zipCd, '') AS zipCd,
				IFNULL(c.feeAccntBankCd, '') AS feeAccntBankCd,
				IFNULL(c.feeAccntNo, '') AS feeAccntNo,
				IFNULL(c.feeAccntNm, '') AS feeAccntNm,
				IFNULL(c.feeType1Amt, 0) AS feeType1Amt,
				IFNULL(c.feeType2Amt, 0) AS feeType2Amt,
				IFNULL(c.prflImgFileNm, '') AS prflImgFileNm,
				IFNULL(c.intrdctn, '') AS intrdctn,
				IFNULL(c.joinQstn, '') AS joinQstn,
				IFNULL((SELECT
					ca.attndDate
				FROM
					clubAttnd ca
				WHERE
					ca.clubNo = c.clubNo
				AND
					ca.attndDate >= CURDATE()
				AND
					ca.cnfrmYn IS NULL
				GROUP BY
					ca.attndDate
				ORDER BY
					ca.attndDate
				LIMIT 1
				), '') AS attndDateMin
			FROM
				club c,
				mmbr m
			WHERE
				c.mstrMmbrNo = m.mmbrNo
			AND
				c.mstrMmbrNo = #{mmbrNo}
		]]>
	</select>
	
	
	<select id="selectMyClubPlayRcrdList" parameterType="hashmap" resultType="hashmap">
		<include refid="com.pagingPre"/>
			SELECT
				p.playNo,
				p.playNm,
				g.gameNo,
				g.gameNm,
				IFNULL(DATE_FORMAT(p.endDt, "%Y.%m.%d %H:%i"), '') AS endDt,
				p.sttsCd,
				cdNm('C002', p.sttsCd) AS sttsNm,
				(SELECT
					GROUP_CONCAT(m1.nickNm ORDER BY pm1.rsltRnk, m1.mmbrNo SEPARATOR ',')
				FROM
					play p1,
					playMmbr pm1,
					mmbr m1
				WHERE
					p1.playNo = pm1.playNo
				AND
					pm1.mmbrNo = m1.mmbrNo
				AND
					p1.playNo = p.playNo
				) AS playNickNms,
				(SELECT
					GROUP_CONCAT(m2.mmbrNo ORDER BY pm2.rsltRnk, m2.mmbrNo SEPARATOR ',')
				FROM
					play p2,
					playMmbr pm2,
					mmbr m2
				WHERE
					p2.playNo = pm2.playNo
				AND
					pm2.mmbrNo = m2.mmbrNo
				AND
					p2.playNo = p.playNo
				) AS playMmbrNos,
				(SELECT
					GROUP_CONCAT(IFNULL(m3.prflImgFileNm, 'default') ORDER BY pm3.rsltRnk, m3.mmbrNo SEPARATOR ',')
				FROM
					play p3,
					playMmbr pm3,
					mmbr m3
				WHERE
					p3.playNo = pm3.playNo
				AND
					pm3.mmbrNo = m3.mmbrNo
				AND
					p3.playNo = p.playNo
				) AS playMmbrPrflImgFileNms,
				IFNULL((SELECT
					GROUP_CONCAT(m4.nickNm ORDER BY m4.mmbrNo SEPARATOR ',')
				FROM
					play p4,
					playMmbr pm4,
					mmbr m4
				WHERE
					p4.playNo = pm4.playNo
				AND
					pm4.mmbrNo = m4.mmbrNo
				AND
					p4.playNo = p.playNo
				AND
					pm4.rsltRnk = 1
				), '') AS bestPlayNickNms
			FROM
				play p,
				game g,
				club c
			WHERE
				p.gameNo = g.gameNo
			AND
				p.clubNo = c.clubNo
			AND
				p.clubNo = #{clubNo}
			ORDER BY
				p.playNo DESC
		<include refid="com.pagingPost"/>
	</select>
	
	<select id="selectMyClubPlayRcrdListCnt" parameterType="hashmap" resultType="hashmap">
		<![CDATA[
			SELECT
				COUNT(*) AS cnt
			FROM
				play p,
				game g,
				club c
			WHERE
				p.gameNo = g.gameNo
			AND
				p.clubNo = c.clubNo
			AND
				p.clubNo = #{clubNo}
		]]>
	</select>
	
	<select id="selectMyClubJoinList" parameterType="hashmap" resultType="hashmap">
		<![CDATA[
			SELECT
				cj.seq,
				cj.mmbrNo,
				m.nickNm,
				cj.reqDate,
				(SELECT
					COUNT(*)
				FROM
					playMmbr pm1
				WHERE
					pm1.mmbrNo = m.mmbrNo
				) AS playCnt,
				IFNULL(m.intrdctn, '') AS intrdctn,
				IFNULL(m.prflImgFileNm, '') AS prflImgFileNm,
				IFNULL(cj.joinAnswr, '') AS joinAnswr
			FROM
				club c,
				clubJoin cj,
				mmbr m
			WHERE
				c.clubNo = cj.clubNo
			AND
				cj.mmbrNo = m.mmbrNo
			AND
				m.useYn = 'Y'
			AND
				m.mmbrTypeCd = '1'
			AND
				IFNULL(cj.cnfrmYn, '') = ''
			AND
				c.clubNo = #{clubNo}
			ORDER BY
				cj.seq
		]]>
	</select>
	
	<select id="selectMyClubAttndNotCnfrmList" parameterType="hashmap" resultType="hashmap">
		<![CDATA[
			SELECT
				ca.seq,
				ca.clubNo,
				c.clubNm,
				IFNULL(c.prflImgFileNm, '') AS prflImgFileNm,
				ca.attndDate,
				IFNULL(ca.attndYn, 'N') AS attndYn
			FROM
				clubAttnd ca,
				mmbr m,
				club c
			WHERE
				ca.mmbrNo = m.mmbrNo
			AND
				ca.clubNo = c.clubNo
			AND
				ca.clubNo = #{clubNo}
			AND
				ca.mmbrNo = #{mmbrNo}
			AND
				IFNULL(ca.cnfrmYn, 'N') = 'N'
			ORDER BY
				ca.seq DESC
		]]>
	</select>
	
	<select id="selectMyClubFeePayList" parameterType="hashmap" resultType="hashmap">
		<include refid="com.pagingPre"/>
			SELECT
				cf.seq,
				cf.clubNo,
				c.clubNm,
				IFNULL(c.prflImgFileNm, '') AS prflImgFileNm,
				cf.feeAmt,
				cf.feeTypeCd,
				cdNm('C008', cf.feeTypeCd) AS feeTypeNm,
				CONCAT(cf.feeFromDate, ' ~ ', cf.feeToDate) AS feeDate,
				IFNULL(cf.payYn, 'N') AS payYn,
				IFNULL(cf.payDate, '') AS payDate,
				IFNULL(cf.cnfrmYn, 'N') AS cnfrmYn,
				IFNULL(cf.cnfrmDate, '') AS cnfrmDate
			FROM
				clubFee cf,
				mmbr m,
				club c
			WHERE
				cf.mmbrNo = m.mmbrNo
			AND
				cf.clubNo = c.clubNo
			AND
				cf.mmbrNo = #{mmbrNo}
			<if test="payYn != null and payYn != ''">
			AND
				IFNULL(cf.payYn, 'N') = #{payYn}
			</if>
			<if test="cnfrmYn != null and cnfrmYn != ''">
			AND
				IFNULL(cf.cnfrmYn, 'N') = #{cnfrmYn}
			</if>
			ORDER BY
				cf.seq DESC
		<include refid="com.pagingPost"/>
	</select>
	
	<select id="selectMyClubFeePayListCnt" parameterType="hashmap" resultType="hashmap">
			SELECT
				COUNT(*) AS cnt
			FROM
				clubFee cf,
				mmbr m,
				club c
			WHERE
				cf.mmbrNo = m.mmbrNo
			AND
				cf.clubNo = c.clubNo
			AND
				cf.mmbrNo = #{mmbrNo}
			<if test="payYn != null and payYn != ''">
			AND
				IFNULL(cf.payYn, 'N') = #{payYn}
			</if>
			<if test="cnfrmYn != null and cnfrmYn != ''">
			AND
				IFNULL(cf.cnfrmYn, 'N') = #{cnfrmYn}
			</if>
	</select>
	
	<select id="selectMyClubFeeList" parameterType="hashmap" resultType="hashmap">
		<include refid="com.pagingPre"/>
			SELECT
				cf.seq,
				cf.clubNo,
				cf.mmbrNo,
				m.nickNm,
				IFNULL(m.prflImgFileNm, '') AS prflImgFileNm,
				cf.feeAmt,
				cf.feeTypeCd,
				cdNm('C008', cf.feeTypeCd) AS feeTypeNm,
				CONCAT(cf.feeFromDate, ' ~ ', cf.feeToDate) AS feeDate,
				IFNULL(cf.payYn, 'N') AS payYn,
				IFNULL(cf.payDate, '') AS payDate,
				IFNULL(cf.cnfrmYn, 'N') AS cnfrmYn,
				IFNULL(cf.cnfrmDate, '') AS cnfrmDate
			FROM
				clubFee cf,
				mmbr m,
				club c
			WHERE
				cf.mmbrNo = m.mmbrNo
			AND
				cf.clubNo = c.clubNo
			AND
				cf.clubNo = #{clubNo}
			<if test="payYn != null and payYn != ''">
			AND
				IFNULL(cf.payYn, 'N') = #{payYn}
			</if>
			<if test="cnfrmYn != null and cnfrmYn != ''">
			AND
				IFNULL(cf.cnfrmYn, 'N') = #{cnfrmYn}
			</if>
			ORDER BY
				cf.seq DESC
		<include refid="com.pagingPost"/>
	</select>
	
	<select id="selectMyClubFeeListCnt" parameterType="hashmap" resultType="hashmap">
			SELECT
				COUNT(*) AS cnt
			FROM
				clubFee cf,
				mmbr m,
				club c
			WHERE
				cf.mmbrNo = m.mmbrNo
			AND
				cf.clubNo = c.clubNo
			AND
				cf.clubNo = #{clubNo}
			<if test="payYn != null and payYn != ''">
			AND
				IFNULL(cf.payYn, 'N') = #{payYn}
			</if>
			<if test="cnfrmYn != null and cnfrmYn != ''">
			AND
				IFNULL(cf.cnfrmYn, 'N') = #{cnfrmYn}
			</if>
	</select>

	<select id="selectMyClubBrdList" parameterType="hashmap" resultType="hashmap">
		<include refid="com.pagingPre"/>
		SELECT
		cb.seq,
		cb.mmbrNo,
		m.nickNm,
		IFNULL(m.prflImgFileNm, '') AS prflImgFileNm,
		cb.brdTypeCd,
		cdNm('C007', cb.brdTypeCd) AS brdTypeNm,
		cb.title,
		cb.cntnts,
		DATE_FORMAT(cb.insDt, "%Y.%m.%d %H:%i") AS insDt,
		IF(cb.mmbrNo = #{mmbrNo} AND cb.brdTypeCd != '1',
		'Y',
		'N'
		) AS wrtrYn
		FROM
		clubBrd cb,
		mmbr m
		WHERE
		cb.mmbrNo = m.mmbrNo
		AND
		cb.useYn = 'Y'
		AND
		m.useYn = 'Y'
		AND
		EXISTS
		(SELECT
		*
		FROM
		clubBrd
		WHERE
		mmbrNo = #{mmbrNo}
		AND
		clubNo = cb.clubNo
		)
		ORDER BY
		cb.seq
		<include refid="com.pagingPost"/>
	</select>

	<select id="selectMyClubBrdListCnt" parameterType="hashmap" resultType="hashmap">
		<![CDATA[
		SELECT
			COUNT(*) AS cnt
		FROM
			clubBrd cb,
			mmbr m
		WHERE
			cb.mmbrNo = m.mmbrNo
		  AND
			cb.useYn = 'Y'
		  AND
			m.useYn = 'Y'
		  AND
			EXISTS
				(SELECT
					 *
				 FROM
					 clubBrd
				 WHERE
					 mmbrNo = #{mmbrNo}
				   AND
					 clubNo = cb.clubNo
				)
		]]>
	</select>

	<select id="selectMyClubPlayImgList" parameterType="hashmap" resultType="hashmap">
		<include refid="com.pagingPre"/>
		SELECT
		p.playNo,
		pm.seq,
		pm.rsltRnk,
		DATE(p.endDt) AS endDate,
		IFNULL(DATE_FORMAT(p.endDt, "%Y.%m.%d %H:%i"), '') AS endDt,
		g.gameNm,
		IFNULL(pm.fdbck, '') AS fdbck,
		pm.fdbckImgFileNm,
		pm.mmbrNo,
		m.nickNm,
		IFNULL(m.prflImgFileNm, '') AS prflImgFileNm
		FROM
		club c,
		play p,
		playMmbr pm,
		mmbr m,
		game g
		WHERE
		c.clubNo = p.clubNo
		AND
		p.playNo = pm.playNo
		AND
		pm.mmbrNo = m.mmbrNo
		AND
		p.gameNo = g.gameNo
		AND
		IFNULL(pm.fdbckImgFileNm, '') != ''
		AND
		c.clubNo = #{clubNo}
		ORDER BY
		pm.seq DESC
		<include refid="com.pagingPost"/>
	</select>

	<select id="selectMyClubPlayImgListCnt" parameterType="hashmap" resultType="hashmap">
		<![CDATA[
		SELECT
			COUNT(*) AS cnt
		FROM
			club c,
			play p,
			playMmbr pm,
			mmbr m
		WHERE
			c.clubNo = p.clubNo
		  AND
			p.playNo = pm.playNo
		  AND
			pm.mmbrNo = m.mmbrNo
		  AND
			IFNULL(pm.fdbckImgFileNm, '') != ''
			AND
				c.clubNo = #{clubNo}
		]]>
	</select>

	<select id="selectClubGameHasList" parameterType="hashmap" resultType="hashmap">
		<include refid="com.pagingPre"/>
		SELECT
		g.gameNo,
		IFNULL(g.gameNm, '') AS gameNm
		FROM
		game g
		LEFT JOIN clubGame cg
		ON g.gameNo = cg.gameNo
		AND cg.clubNo = #{clubNo}
		WHERE
		1 = 1
		<if test="hasYn == 'Y'.toString()">
			AND
			IFNULL(cg.gameNo, '') != ''
		</if>
		<if test="hasYn == 'N'.toString()">
			AND
			IFNULL(cg.gameNo, '') = ''
		</if>
		<if test="gameNm != null and gameNm != ''">
			AND
			g.gameNm LIKE CONCAT('%',#{gameNm},'%')
		</if>
		ORDER BY
		g.gameNm
		<include refid="com.pagingPost"/>
	</select>

	<select id="selectClubGameHasListCnt" parameterType="hashmap" resultType="hashmap">
		SELECT
		COUNT(*) AS cnt
		FROM
		game g
		LEFT JOIN clubGame cg
		ON g.gameNo = cg.gameNo
		AND cg.clubNo = #{clubNo}
		WHERE
		1 = 1
		<if test="hasYn == 'Y'.toString()">
			AND
			IFNULL(cg.gameNo, '') != ''
		</if>
		<if test="hasYn == 'N'.toString()">
			AND
			IFNULL(cg.gameNo, '') = ''
		</if>
		<if test="gameNm != null and gameNm != ''">
			AND
			g.gameNm LIKE CONCAT('%',#{gameNm},'%')
		</if>
	</select>

	<insert id="insertClubGame" parameterType="hashmap">
		INSERT INTO clubGame
		(
			clubNo,
			gameNo,
			insId,
			insDt,
			updId,
			updDt
		)
		VALUES
			(
				#{clubNo},
				#{gameNo},
				'system',
				CURRENT_TIMESTAMP,
				'system',
				CURRENT_TIMESTAMP
			)
	</insert>

	<delete id="deleteClubGame" parameterType="hashmap">
		<![CDATA[
		DELETE FROM
			clubGame
		WHERE
			clubNo = #{clubNo}
		  AND
			gameNo = #{gameNo}
		]]>
	</delete>


	<select id="selectClubAttndList" parameterType="hashmap" resultType="hashmap">
		<include refid="com.pagingPre"/>
		SELECT
		ca.seq,
		ca.mmbrNo,
		m.nickNm,
		IFNULL(m.prflImgFileNm, '') AS prflImgFileNm,
		ca.attndDate,
		ca.reqDate,
		IFNULL(ca.attndYn, '') AS attndYn,
		IFNULL(ca.cnfrmYn, '') AS cnfrmYn
		FROM
		clubAttnd ca,
		mmbr m
		WHERE
		ca.mmbrNo = m.mmbrNo
		AND
		ca.clubNo = #{clubNo}
		<if test="mmbrNo != null and mmbrNo != ''">
			AND
			ca.mmbrNo = #{mmbrNo}
		</if>
		<if test="nickNm != null and nickNm != ''">
			AND
			m.nickNm LIKE CONCAT('%',#{nickNm},'%')
		</if>
		<if test="mmbrNo != null and mmbrNo != ''">
			AND
			ca.mmbrNo = #{mmbrNo}
		</if>
		<if test="attndDate != null and attndDate != ''">
			AND
			ca.attndDate = #{attndDate}
		</if>
		<if test="attndYn != null and attndYn != ''">
			AND
			IFNULL(ca.attndYn, 'N') = #{attndYn}
		</if>
		<if test="cnfrmYn != null and cnfrmYn != ''">
			AND
			IFNULL(ca.cnfrmYn, 'N') = #{cnfrmYn}
		</if>
		ORDER BY
		ca.attndDate DESC,
		ca.seq DESC
		<include refid="com.pagingPost"/>
	</select>

	<select id="selectClubAttndListCnt" parameterType="hashmap" resultType="hashmap">
		SELECT
		COUNT(*) AS cnt
		FROM
		clubAttnd ca,
		mmbr m
		WHERE
		ca.mmbrNo = m.mmbrNo
		AND
		ca.clubNo = #{clubNo}
		<if test="mmbrNo != null and mmbrNo != ''">
			AND
			ca.mmbrNo = #{mmbrNo}
		</if>
		<if test="nickNm != null and nickNm != ''">
			AND
			m.nickNm LIKE CONCAT('%',#{nickNm},'%')
		</if>
		<if test="mmbrNo != null and mmbrNo != ''">
			AND
			ca.mmbrNo = #{mmbrNo}
		</if>
		<if test="attndDate != null and attndDate != ''">
			AND
			ca.attndDate = #{attndDate}
		</if>
		<if test="cnfrmYn != null and cnfrmYn != ''">
			AND
			IFNULL(ca.cnfrmYn, 'N') = #{cnfrmYn}
		</if>
	</select>

	<insert id="insertClubAttndAll" parameterType="hashmap">
		INSERT INTO clubAttnd
		(
			clubNo,
			mmbrNo,
			attndDate,
			reqDate,
			insId,
			insDt,
			updId,
			updDt
		)
		SELECT
			cm.clubNo,
			cm.mmbrNo,
			#{attndDate},
			CURDATE(),
			'system',
			CURRENT_TIMESTAMP,
			'system',
			CURRENT_TIMESTAMP
		FROM
			clubMmbr cm,
			mmbr m
		WHERE
			cm.mmbrNo = m.mmbrNo
		  AND
			m.useYn = 'Y'
		AND
			cm.activated IS TRUE
		  AND
			cm.clubNo = #{clubNo}
	</insert>

	<insert id="insertClubAttnd" parameterType="hashmap">
		INSERT INTO clubAttnd
		(
			clubNo,
			mmbrNo,
			attndDate,
			reqDate,
			insId,
			insDt,
			updId,
			updDt
		)
		VALUES
			(
				#{clubNo},
				#{mmbrNo},
				#{attndDate},
				CURDATE(),
				'system',
				CURRENT_TIMESTAMP,
				'system',
				CURRENT_TIMESTAMP
			)
	</insert>

	<update id="updateClubAttnd" parameterType="hashmap">
		UPDATE
		clubAttnd
		SET
		<if test="attndYn != null and attndYn != ''">
			attndYn = #{attndYn},
		</if>
		<if test="cnfrmYn != null and cnfrmYn != ''">
			cnfrmYn = #{cnfrmYn},
		</if>
		updId = 'system',
		updDt = CURRENT_TIMESTAMP
		WHERE
		seq = #{seq}
	</update>

	<delete id="deleteClubAttnd" parameterType="hashmap">
		DELETE FROM
		clubAttnd
		<if test="seq != null and seq != ''">
			WHERE
			seq = #{seq}
		</if>
		<if test="mode == 'cancel'.toString()">
			WHERE
			clubNo = #{clubNo}
			AND
			attndDate = #{attndDate}
		</if>
	</delete>

	<select id="selectClubFee" parameterType="hashmap" resultType="hashmap">
		SELECT
		cf.feeTypeCd,
		cdNm('C008', cf.feeTypeCd) AS feeTypeNm,
		cf.feeAmt,
		cf.feeFromDate,
		cf.feeToDate,
		IFNULL(cf.payYn, 'N') AS payYn,
		IFNULL(cf.payDate, '') AS payDate,
		IFNULL(cf.cnfrmYn, 'N') AS cnfrmYn,
		IFNULL(cf.cnfrmDate, '') AS cnfrmDate
		FROM
		clubFee cf
		WHERE
		1=1
		<if test="seq != null and seq != ''">
			AND
			cf.seq = #{seq}
		</if>
		<if test="clubNo != null and clubNo != ''">
			AND
			cf.clubNo = #{clubNo}
		</if>
		<if test="mmbrNo != null and mmbrNo != ''">
			AND
			cf.mmbrNo = #{mmbrNo}
		</if>
		<if test="feeTypeCd != null and feeTypeCd != ''">
			AND
			cf.feeTypeCd = #{feeTypeCd}
		</if>
	</select>

	<select id="selectClubFeePay" parameterType="hashmap" resultType="hashmap">
		<![CDATA[
		SELECT
			IF(COUNT(cf.seq) > 0,
			   'Y',
			   'N'
				) AS feePayYn,
			IFNULL(c.feeType1Amt, 0) AS feeType1Amt,
			IFNULL(c.feeType2Amt, 0) AS feeType2Amt
		FROM
			clubFee cf,
			club c
		WHERE
			cf.clubNo = c.clubNo
		  AND
			cf.clubNo = #{clubNo}
		  AND
			cf.mmbrNo = #{mmbrNo}
		  AND
			cf.feeTypeCd IN ('1', '2')
		  AND
			cf.cnfrmYn = 'Y'
		  AND
			CURDATE() BETWEEN cf.feeFromDate AND cf.feeToDate
		]]>
	</select>

	<insert id="insertClubFee" parameterType="hashmap">
		INSERT INTO clubFee
		(
		clubNo,
		mmbrNo,
		feeTypeCd,
		feeAmt,
		feeFromDate,
		feeToDate,
		<if test="feeTypeCd == '2'.toString()">
			payYn,
			payDate,
		</if>
		insId,
		insDt,
		updId,
		updDt
		)
		VALUES
		(
		#{clubNo},
		#{mmbrNo},
		#{feeTypeCd},
		REPLACE(#{feeAmt}, ',', ''),
		<if test="feeTypeCd == '1'.toString()">
			CURDATE(),
			CURDATE(),
		</if>
		<if test="feeTypeCd == '2'.toString()">
			#{feeFromDate},
			#{feeToDate},
			'Y',
			CURDATE(),
		</if>
		<if test="feeTypeCd == '3'.toString()">
			#{feeDate},
			#{feeDate},
		</if>
		'system',
		CURRENT_TIMESTAMP,
		'system',
		CURRENT_TIMESTAMP
		)
	</insert>

	<update id="updateClubFee" parameterType="hashmap">
		UPDATE
		clubFee
		SET
		<if test="feeFromDate != null and feeFromDate != ''">
			feeFromDate = #{feeFromDate},
		</if>
		<if test="feeToDate != null and feeToDate != ''">
			feeToDate = #{feeToDate},
		</if>
		<if test="mode == 'pay'.toString()">
			payYn = 'Y',
			payDate = CURDATE(),
		</if>
		<if test="mode == 'cnfrm'.toString()">
			cnfrmYn = 'Y',
			cnfrmDate = CURDATE(),
		</if>
		updId = 'system',
		updDt = CURRENT_TIMESTAMP
		WHERE
		seq = #{seq}
	</update>

	<delete id="deleteClubFee" parameterType="hashmap">
		<![CDATA[
		DELETE FROM
			clubFee
		WHERE
			seq = #{seq}
		]]>
	</delete>
	
</mapper>
