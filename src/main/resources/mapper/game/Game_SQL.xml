<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="game">

    <select id="selectGamePlayById" parameterType="long" resultType="hashmap">
        SELECT
            p.playNo,
            p.playNm,
            p.sttsCd
        FROM
            play p
        WHERE
            p.sttsCd = '1'
          AND
            p.playNo = #{playNo}
    </select>

    <select id="selectClientPlayMemberList" parameterType="hashmap" resultType="hashmap">
        SELECT
            pm.mmbrNo,
            m.nickNm
        FROM
            play p,
            playMmbr pm,
            mmbr m
        WHERE
            p.playNo = pm.playNo
          AND
            pm.mmbrNo = m.mmbrNo
          AND
            p.sttsCd = '1'
          AND
            p.playNo = #{playNo}
        ORDER BY
            m.nickNm
    </select>

    <select id="selectHostPlayMember" parameterType="hashmap" resultType="hashmap">
        SELECT
            m.mmbrNo,
            m.nickNm
        FROM
            play p,
            mmbr m
        WHERE
            p.hostMmbrNo = m.mmbrNo
          AND
            p.sttsCd = '1'
          AND
            p.playNo = #{playNo}
    </select>

    <insert id="insertPlayLog" parameterType="boardgame.fo.game.dto.SavePlayRequestDto">
        INSERT INTO playLog
        (
            playNo,
            log
        )
        VALUES
        (
            #{playNo},
            #{log}
        )
    </insert>

    <select id="selectLastPlayLog" parameterType="long" resultType="hashmap">
        SELECT
            pl.log
        FROM
            play p,
            playLog pl
        WHERE
            p.playNo = pl.playNo
          AND
            p.sttsCd = '1'
          AND
            pl.playNo = #{playNo}
        ORDER BY
            pl.dateTime DESC
        LIMIT
            1
    </select>

    <delete id="deletePlayLogByPlayNo" parameterType="long">
        DELETE FROM
            playLog
        WHERE
            playNo = #{playNo}
    </delete>

    <select id="selectGameList" parameterType="hashmap" resultType="hashmap">
        SELECT
            g.gameNo,
            g.gameNm,
            g.minPlyrCnt,
            g.maxPlyrCnt
        FROM
            game g
        <where>
            <if test="gameName != null and gameName != ''">
                AND
                    g.gameNm LIKE CONCAT('%',#{gameName},'%')
            </if>
        </where>
        ORDER BY
            g.gameNm
    </select>

    <select id="selectGameSettingList" parameterType="hashmap" resultType="hashmap">
        SELECT
            gs.nm,
            gs.cd,
            IFNULL(gs.rmrk, '') AS rmrk
        FROM
            game g,
            gameSttng gs
        WHERE
            g.gameNo = gs.gameNo
        AND
            g.gameNo = #{gameNo}
        <if test="groupCode == '1'.toString()">
        AND
            g.sttng1GrpCd = gs.grpCd
        AND
            g.sttng1GrpCd = #{groupCode}
        </if>
        <if test="groupCode == '2'.toString()">
        AND
            g.sttng2GrpCd = gs.grpCd
        AND
            g.sttng2GrpCd = #{groupCode}
        </if>
        <if test="groupCode == '3'.toString()">
        AND
            g.sttng3GrpCd = gs.grpCd
        AND
            g.sttng3GrpCd = #{groupCode}
        </if>
        ORDER BY
            gs.ordr
    </select>

</mapper>
